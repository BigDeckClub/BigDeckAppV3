Step 1: Find and Inspect the Endpoint
File: server.js (around line 1280+)

Find the endpoint: /api/inventory/:id/toggle-alert

It probably looks something like this (broken version):

JavaScript
app. post('/api/inventory/:id/toggle-alert', async (req, res) => {
  const { id } = req.params;
  const item = await db.get('SELECT * FROM inventory WHERE id = ?', [id]);
  // Missing the actual UPDATE query!
  res.json(item);
});
Step 2: Replace with Correct Implementation
The endpoint needs to:

Toggle the low_inventory_alert value in the database
Return the updated item
Replace the endpoint with:

JavaScript
app. post('/api/inventory/:id/toggle-alert', async (req, res) => {
  try {
    const { id } = req. params;
    
    // Toggle the low_inventory_alert value (flip true <-> false)
    await db.run(
      'UPDATE inventory SET low_inventory_alert = NOT low_inventory_alert WHERE id = ?',
      [id]
    );
    
    // Fetch the updated item to return
    const updatedItem = await db.get('SELECT * FROM inventory WHERE id = ?', [id]);
    
    console.log('Toggled alert for item', id, '- new value:', updatedItem. low_inventory_alert);
    
    res.json(updatedItem);
  } catch (error) {
    console.error('Error toggling alert:', error);
    res.status(500).json({ error: 'Failed to toggle alert' });
  }
});
Step 3: Also Check the Set Threshold Endpoint
While you're there, verify /api/inventory/:id/set-threshold also has a proper UPDATE query:

JavaScript
app.post('/api/inventory/:id/set-threshold', async (req, res) => {
  try {
    const { id } = req. params;
    const { threshold } = req. body;
    
    await db.run(
      'UPDATE inventory SET low_inventory_threshold = ? WHERE id = ?',
      [threshold, id]
    );
    
    const updatedItem = await db.get('SELECT * FROM inventory WHERE id = ?', [id]);
    
    res.json(updatedItem);
  } catch (error) {
    console.error('Error setting threshold:', error);
    res.status(500). json({ error: 'Failed to set threshold' });
  }
});
Step 4: Verify the Database Column Exists
Make sure the inventory table has the low_inventory_alert column:

SQL
-- Run this in your database
PRAGMA table_info(inventory);
If the column doesn't exist, add it:

SQL
ALTER TABLE inventory ADD COLUMN low_inventory_alert INTEGER DEFAULT 0;
ALTER TABLE inventory ADD COLUMN low_inventory_threshold INTEGER DEFAULT 0;
Step 5: Test Again
Save server.js
Restart the server
Click the bell icon
Refresh the page
Bell state should now persist!
