âœ” Classifier improvements = correct
âœ” Fallback logic = correct
âŒ Fallback baseline still includes $1.99 variants that should not be used as the baseline

Because:

All Lightning Bolt and Sol Ring products are classified as â€œspecialâ€

The fallback selects the cheapest non-foil/etched/promo/premium product

Showcase editions are â€œspecialâ€, but also cheap â†’ included â†’ $1.99 becomes baseline

That baseline infects PASS 3 logic

$2.29 never becomes â€œnormalâ€

So the cheaper variant suppresses the real standard edition again.

ğŸ¯ The Final Missing Piece
Your fallback must exclude variant editions like showcase/extended art, even when they arenâ€™t foil, etched, promo, or premium.

Because the $1.99 editions are absolutely variants, even though the name doesnâ€™t say â€œshowcase.â€

The classifier does correctly flag them as "special".

So the fallback must exclude "special".

âœ” Corrected Fallback Baseline Logic

Replace the fallback block with this:

// FALLBACK: no normals â†’ use lowest non-premium AND non-special price
if (lowestNormalPrice === null) {
  let fallback = null;
  for (const p of rawProducts) {
    // Exclude ALL variants, only allow plain non-special items
    if (
      p.variant !== "foil" &&
      p.variant !== "etched" &&
      p.variant !== "promo" &&
      p.variant !== "premium" &&
      p.variant !== "special" // <-- NEW LINE
    ) {
      if (fallback === null || p.price < fallback) {
        fallback = p.price;
      }
    }
  }

  // If STILL nothing found (all were variants),
  // fallback to cheapest non-foil as last resort
  if (fallback === null) {
    for (const p of rawProducts) {
      if (
        p.variant !== "foil" &&
        p.variant !== "etched" &&
        p.variant !== "promo" &&
        p.variant !== "premium"
      ) {
        if (fallback === null || p.price < fallback) {
          fallback = p.price;
        }
      }
    }
  }

  lowestNormalPrice = fallback;
}

ğŸ§  Why This Works
This change ensures:

$1.99 variant â†’ "special" â†’ ignored in fallback

$2.29 â†’ "set" or "normal", depending on classifier â†’ eligible for fallback

Swamp â†’ still works correctly because its set-edition $0.35 is "set" not "special"

Expected Behavior After Fix
Lightning Bolt

$1.99 showcase â†’ special â†’ excluded

$2.29 standard â†’ baseline
â†’ final = $2.29

Sol Ring

Same behavior
â†’ final = $2.29

Swamp

$0.35 â†’ "set" â†’ eligible

$4.99 â†’ "special" â†’ excluded
â†’ final = $0.35

ğŸ‰ This is the final missing component

No hacks.
No demoting normals.
No fragile price-based conditions.
Just a correct semantic separation of variant vs. non-variant items.