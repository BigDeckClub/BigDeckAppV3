Step 1: Add Supabase client to server.js
At the top of server.js, after the other imports, add:

JavaScript
import { createClient } from '@supabase/supabase-js';

// Server-side Supabase client (use service role key for auth operations)
const supabase = createClient(
  process.env. SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);
Step 2: Add the auth endpoints to server.js
Add these endpoints (place them before the catch-all SPA handler):

JavaScript
// ========== AUTH PROXY ENDPOINTS ==========

// Login endpoint
app.post('/api/auth/login', async (req, res) => {
  const { email, password } = req.body;
  
  if (!email || !password) {
    return res.status(400).json({ error: 'Email and password are required' });
  }
  
  try {
    const { data, error } = await supabase.auth.signInWithPassword({ 
      email, 
      password 
    });
    
    if (error) {
      console.error('Login error:', error. message);
      return res.status(401).json({ error: error.message });
    }
    
    res.json(data);
  } catch (err) {
    console.error('Login exception:', err);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// Signup endpoint
app.post('/api/auth/signup', async (req, res) => {
  const { email, password } = req.body;
  
  if (!email || !password) {
    return res.status(400).json({ error: 'Email and password are required' });
  }
  
  if (password.length < 6) {
    return res.status(400).json({ error: 'Password must be at least 6 characters' });
  }
  
  try {
    const { data, error } = await supabase.auth.signUp({ 
      email, 
      password 
    });
    
    if (error) {
      console.error('Signup error:', error.message);
      return res. status(400).json({ error: error.message });
    }
    
    res.json(data);
  } catch (err) {
    console.error('Signup exception:', err);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// Get current session endpoint
app.get('/api/auth/session', async (req, res) => {
  const authHeader = req.headers.authorization;
  
  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return res. json({ user: null });
  }
  
  const token = authHeader.split(' ')[1];
  
  try {
    const { data: { user }, error } = await supabase. auth.getUser(token);
    
    if (error || !user) {
      return res.json({ user: null });
    }
    
    res. json({ user });
  } catch (err) {
    res.json({ user: null });
  }
});
Step 3: Set environment variables
Make sure these secrets are set in Replit:

SUPABASE_URL - Your Supabase project URL (e.g., https://wdzdtomcrapycfciqdnq.supabase.co)
SUPABASE_SERVICE_ROLE_KEY - The service_role key from Supabase dashboard (NOT the anon key)
You can find these in your Supabase dashboard under Settings â†’ API.

Step 4: Update AuthContext.jsx to use the proxy
The AuthContext.jsx needs to call these backend endpoints instead of Supabase directly:

JavaScript
const login = async (email, password) => {
  const res = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  
  const data = await res.json();
  if (!res.ok) throw new Error(data.error || 'Login failed');
  
  setUser(data.user);
  return data;
};

const signup = async (email, password) => {
  const res = await fetch('/api/auth/signup', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  
  const data = await res.json();
  if (! res.ok) throw new Error(data.error || 'Signup failed');
  
  setUser(data.user);
  return data;
};
After making these changes, restart the server and test login/signup again.