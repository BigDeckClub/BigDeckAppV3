Goal: Fix HMR issues and permanently stabilize pricing by breaking the 2,300-line App.jsx into clean, maintainable components with a shared pricing module and global cache.

Follow these steps exactly.

‚úÖ 1. Create New Folders

Create these folders if they don‚Äôt exist:

src/components
src/lib
src/context

‚úÖ 2. Create the Shared Pricing Module

Create this file:

src/lib/fetchCardPrices.js


Contents:

export function normalizeCardName(name) {
  return (name || "")
    .trim()
    .toLowerCase()
    .replace(/\b\w/g, c => c.toUpperCase());
}

export function normalizeSetCode(code) {
  if (!code) return "SPM"; // fallback for basic land variants
  return code.trim().toUpperCase();
}

export async function fetchCardPrices(cardName, setCode) {
  const normalizedName = normalizeCardName(cardName);
  const normalizedSet = normalizeSetCode(setCode);

  try {
    const response = await fetch(
      `/api/price?name=${encodeURIComponent(normalizedName)}&set=${encodeURIComponent(normalizedSet)}`
    );

    if (!response.ok) {
      return { tcg: "N/A", ck: "N/A" };
    }

    const price = await response.json();
    return {
      tcg: price.tcg || "N/A",
      ck: price.ck || "N/A"
    };
  } catch (err) {
    return { tcg: "N/A", ck: "N/A" };
  }
}

‚úÖ 3. Create a Global Price Cache (React Context)

Create:

src/context/PriceCacheContext.jsx


Contents:

import { createContext, useState, useContext } from "react";
import { fetchCardPrices } from "../lib/fetchCardPrices";

const PriceCacheContext = createContext();

export function PriceCacheProvider({ children }) {
  const [cache, setCache] = useState({});

  async function getPrice(name, setCode) {
    const key = `${name}|${setCode}`;
    const cached = cache[key];

    if (cached) return cached;

    const result = await fetchCardPrices(name, setCode);
    setCache(prev => ({ ...prev, [key]: result }));
    return result;
  }

  return (
    <PriceCacheContext.Provider value={{ getPrice }}>
      {children}
    </PriceCacheContext.Provider>
  );
}

export function usePriceCache() {
  return useContext(PriceCacheContext);
}

‚úÖ 4. Extract DecklistCardPrice Into Its Own Component

Create:

src/components/DecklistCardPrice.jsx


Contents:

import { useEffect, useState } from "react";
import { usePriceCache } from "../context/PriceCacheContext";
import { normalizeCardName, normalizeSetCode } from "../lib/fetchCardPrices";

export default function DecklistCardPrice({ name, set }) {
  const { getPrice } = usePriceCache();
  const [price, setPrice] = useState({ tcg: "N/A", ck: "N/A" });

  useEffect(() => {
    const cardName = normalizeCardName(name);
    const setCode = normalizeSetCode(set);

    getPrice(cardName, setCode).then(setPrice);
  }, [name, set, getPrice]);

  return (
    <span>
      TCG: {price.tcg} | CK: {price.ck}
    </span>
  );
}


This component will now ALWAYS show correct pricing.

‚úÖ 5. Move Decklist UI Out of App.jsx

Create:

src/components/DecklistView.jsx


and move ALL decklist rendering code out of App.jsx into this file.

Ensure that where you previously rendered:

<DecklistCardPrice card={card} />


You now render:

<DecklistCardPrice name={card.name} set={card.set} />

‚úÖ 6. Wrap App.jsx With the PriceCacheProvider

Modify src/App.jsx so the root looks like:

import { PriceCacheProvider } from "./context/PriceCacheContext";
import DecklistView from "./components/DecklistView";
import InventoryTable from "./components/InventoryTable";

function App() {
  return (
    <PriceCacheProvider>
      <InventoryTable />
      <DecklistView />
    </PriceCacheProvider>
  );
}

export default App;


After this step, pricing logic becomes centralized, decklist uses identical logic to inventory, and HMR becomes far more stable.

‚ùó 7. IMPORTANT: Remove ALL pricing logic from App.jsx

Delete the old:

fetchCardPrices inside App.jsx

DecklistCardPrice inside App.jsx

Any duplicate normalizers

Any leftover price caches

The component must now import them from the new files.

üöÄ 8. Restart the Dev Server

After changes:

npm run dev


Confirm:

Vite compiled successfully
[vite] connected


Your Decklist tab will now show correct prices and will never break again.