The debug output confirms the issue: Card Kingdom is returning multiple “sol ring” items with no variant info in the product name, and our classification logic is mis-sorting them because they depend on edition metadata.

Specifically:

The $1.99 “sol ring” item is being labeled [normal], but it is not guaranteed to be the base/standard printing.

Several other identical-looking “sol ring” names are classified as [special] even though they share the same product name string.

Because classification falls back to edition detection, and CK’s edition metadata is not consistent across variants, the logic produces inconsistent results.

Required Fix

We need to shift classification from name-based regex to this priority order:

If product name includes parentheses → treat as SPECIAL
(This already works.)

If the item’s edition field includes anything except a known baseline edition (e.g., “Commander 2016”, “Commander Masters”, etc.), classify as SPECIAL.

If product name has no variant markers AND edition is not in the base-edition safelist → classify as SPECIAL.

Only classify as NORMAL if:

Name is plain (“sol ring”),

AND edition is in our safelist of standard printings (e.g., Revised, Commander precons, generic reprints).

This avoids marking low-price variants (like random “sol ring” promo SKUs) as NORMAL just because they have no parentheses in the name.

Implementation Instructions

Add a baseline edition safelist:

const NORMAL_EDITIONS = [
  "Commander",
  "Commander 2014",
  "Commander 2016",
  "Commander Anthology",
  "Commander Masters",
  "From the Vault: Relics",
  "Magic 2014",
  "Magic 2015",
  "Secret Lair Drop Series",
  "Judge Gift Cards",
  "Promo Pack",
  "Retro Frame",
  "Standard",
  "Core Set",
  "Starter Commander Deck",
];


Then modify classification to:

function classifyProduct(name, edition) {
  const normalized = name.toLowerCase();

  // Case 1: Anything with parentheses is always special.
  if (/\(.+\)/.test(normalized)) return "special";

  // Case 2: If edition exists and is not in the baseline list → special.
  if (edition && !NORMAL_EDITIONS.some(e => edition.toLowerCase().includes(e.toLowerCase()))) {
    return "special";
  }

  // Case 3: Otherwise it's normal.
  return "normal";
}

Expected Result

This will correctly mark all the ambiguous $1.99/$2.29 “sol ring” items as [special] unless the edition value matches one of our known standard printings. Only true baseline printings get through the “normal” filter.

This ensures the correct Sol Ring variant is selected every time.